function GetURLParameter(e){for(var t=window.location.search.substring(1),a=t.split("&"),o=0;o<a.length;o++){var n=a[o].split("=");if(n[0]==e)return n[1]}}function setup(){fireBaseID=GetURLParameter("id"),getFireBaseDB(fireBaseID)}function getFireBaseDB(e){casaDataRef.child(e).on("value",function(e){var t=e.child("crawlName");crawlName=t.val();var a=e.child("crawlLocation");crawlLocation=a.val(),$(".crawlname").html(crawlName),$(".crawlLocation").html(crawlLocation)}),casaDataRef.child(e).child("waypoints").on("value",function(e){e.forEach(function(e){var t=e.exportVal(),a=t.lat,o=t.lng,n=new google.maps.LatLng(+a,+o),s=t.stopover,i=t.PubName;markers.push({location:n,stopover:s}),placesNames.push({pubName:i})}),calculateAndDisplayRoute(directionsDisplay,directionsService),google.maps.event.trigger(map,"resize"),$("#TweetName").html("Current Pub: "+placesNames[0].pubName),displayTweets(placesNames[0].pubName)})}function initMap(){var e={center:{lat:0,lng:0},zoom:14,styles:[{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"transit.station",stylers:[{visibility:"off"}]}],fullscreenControl:!0};map=new google.maps.Map(document.getElementById("map"),e),directionsService=new google.maps.DirectionsService,directionsDisplay=new google.maps.DirectionsRenderer({map:map}),geocoder=new google.maps.Geocoder;({url:"../img/bar.png",size:new google.maps.Size(32,37),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(0,0)});map.controls[google.maps.ControlPosition.TOP_RIGHT].push(document.getElementById("pubNext"));var t=0;google.maps.event.addDomListener(document.getElementById("pubNext"),"click",function(e){$("#pubNext").val("Next Pub");var a=markers.length+1;if(t<=markers.length){0==t&&(defaultCenter=map.getCenter()),$("#TweetName").html("Current Pub: "+placesNames[t].pubName),displayTweets(placesNames[t].pubName);var o=new google.maps.LatLng(+route.legs[t].start_location.lat(),+route.legs[t].start_location.lng());map.setCenter(o),map.setZoom(16),t++}else if(t==a){map.controls[google.maps.ControlPosition.TOP_RIGHT].pop(document.getElementById("pubNext")),toggle_visibility("ratings"),map.controls[google.maps.ControlPosition.TOP_RIGHT].push(document.getElementById("ratings")),$("#TweetName").html("Current Pub: "+placesNames[t].pubName),displayTweets(placesNames[t].pubName);var o=new google.maps.LatLng(route.legs[t-1].end_location.lat(),+route.legs[t-1].end_location.lng());map.setCenter(o),map.setZoom(16),t++}})}function toggle_visibility(e){var t=document.getElementById(e);"block"==t.style.display?t.style.display="none":t.style.display="block"}function displayTweets(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){var e=JSON.parse(t.responseText),a="";if(e.length>0){for(var o=0;5>o;o++){a+="<blockquote class='tweet'><p>"+e[o].name+"</p>";for(var n=e[o].text.split(/\s+/),o=0;o<n.length;o++){var s=n[o];("http://"==s.substr(0,7)||"https://"==s.substr(0,8))&&(n[o]='<a href="'+s+'">'+s+"</a> ")}var i=n.join(" ");a+="<p>"+i+"</p></blockquote>"}document.getElementById("twitter").innerHTML=a}else document.getElementById("twitter").innerHTML="No tweets found for this pub"}},t.open("GET","http://rgunodeapp.azurewebsites.net/?q="+e,!0),t.send()}function addRating(){var e=$("#Rating").val();casaDataRef.child(fireBaseID);casaDataRef.child(fireBaseID).child("ratings").push({crawlRating:e}),toggle_visibility("popupBoxTwoPosition")}var map,crawlName,crawlLocation,fireBaseID,casaDataRef=new Firebase("https://casa-pubcrawl.firebaseio.com/routes"),markers=[],directionsService,directionsDisplay,route,placesNames=[],defaultCenter;setup(),$(document).ready(function(){$("#RatingSubmit").on("click",function(){addRating(),window.location.replace("../")})});