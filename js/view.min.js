function pullLocations(){var o=[];casaDataRef.once("value",function(a){a.forEach(function(a){var e=a.val(),n=(a.key(),o.indexOf(e.crawlLocation));o[n]!==e.crawlLocation&&(o.push(e.crawlLocation),$("#pub-locations").append('<option value="'+e.crawlLocation+'">'+e.crawlLocation+"</option>"))}),pullRoutes()},function(o){console.log("The read failed: "+o.code)})}function pullRoutes(){$("#pub-routes").empty();var o=$("#pub-locations option:selected").text();casaDataRef.once("value",function(a){a.forEach(function(a){var e=a.val(),n=a.key();o==e.crawlLocation&&$("#pub-routes").append('<option value="'+n+'">'+e.crawlName+"</option>")}),pullRouteInfo()},function(o){console.log("The read failed: "+o.code)})}function pullRouteInfo(){directionsService=new google.maps.DirectionsService,directionsDisplay=new google.maps.DirectionsRenderer({map:map});var o;casaDataRef.once("value",function(a){var e=a.child($("#pub-routes").val()).val(),n=a.child($("#pub-routes").val());o=n.hasChild("ratings"),o||$("#crawl-rating").html("No Rating"),$("#crawl-name").html(e.crawlName)},function(o){}),0!=o&&casaDataRef.child($("#pub-routes").val()).child("ratings").on("value",function(o){o.forEach(function(o){var a=o.exportVal(),e=a.crawlRating;ratings.push(e)});for(var a=0,e=0;e<ratings.length;e++)a+=parseInt(ratings[e]);var n=Math.round(a/ratings.length);$("#crawl-rating").html(n)});var a=["A","B","C","D","E","F","G","H","I","J"],e=0;casaDataRef.child($("#pub-routes").val()).child("waypoints").on("value",function(o){o.forEach(function(o){var n=o.exportVal(),t=n.lat,l=n.lng,i=new google.maps.LatLng(+t,+l),c=n.stopover,r=n.PubName;console.log(r),$("#route-list").append('<li><span style="color:green;">'+a[e]+": </span>"+r+"</li>"),markers.push({location:i,stopover:c}),e++}),calculateAndDisplayRoute(directionsDisplay,directionsService),google.maps.event.trigger(map,"resize")})}function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:0,lng:0},zoom:2,fullscreenControl:!0}),map.controls[google.maps.ControlPosition.TOP_LEFT].push(document.getElementById("controls-select-container"))}var map,infowindow,markers=[],directionsService,directionsDisplay,ratings=[],casaDataRef=new Firebase("https://casa-pubcrawl.firebaseio.com/routes");$(document).ready(function(){$("#route").hide(),pullLocations(),$("#pub-locations").change(function(){clearRoute(),pullRoutes($("#pub-locations option:selected").text())}),$("#pub-routes").change(function(){clearRoute(),pullRouteInfo()}),$("#start-form").on("submit",function(){return window.location.replace("../display/?id="+$("#pub-routes").val()),!1})});