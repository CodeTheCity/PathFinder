function clearRoute(){if("undefined"!=typeof directionsDisplay&&directionsDisplay.setMap(null),"undefined"!=typeof findMarkers){for(i=0;i<findMarkers.length;i++)findMarkers[i].setMap(null);findMarkers=[]}markers=[],placeNames=[],$("#route-list").empty()}function populateNumPubs(e){for(i=1;i<=e;i++)5==i?$("#num-pubs").append('<option value="'+i+'" selected="selected">'+i+"</option>"):$("#num-pubs").append('<option value="'+i+'">'+i+"</option>")}function searchRadius(e,a,o,i){clearRoute(),infowindow=new google.maps.InfoWindow;var t=new google.maps.places.PlacesService(map);directionsService=new google.maps.DirectionsService,directionsDisplay=new google.maps.DirectionsRenderer({map:map});var n=["A","B","C","D","E","F","G","H","I","J"];t.nearbySearch({location:e,radius:o,types:["bar"]},function(o,t){if(t===google.maps.places.PlacesServiceStatus.OK){for(var r=0;a>r;r++)1==i?addMarker(o[r].geometry.location,map,o[r]):(markers.push({location:o[r].geometry.location,stopover:!0}),placeNames.push({pubName:o[r].name}),$("#route-list").append('<li><span style="color:green;">'+n[r]+":</span> "+o[r].name+"</li>"),$("#route").show());map.setCenter(e),map.setZoom(13),0==i&&calculateAndDisplayRoute(directionsDisplay,directionsService)}else window.alert("Nearby search failed"),$("#route").hide()})}function calculateAndDisplayRoute(e,a){waypoints=[],waypoints=jQuery.extend([],markers);var o=markers[0].location,i=markers[markers.length-1].location;markers.shift(),markers.pop(),a.route({origin:o,destination:i,waypoints:markers,optimizeWaypoints:!0,travelMode:google.maps.TravelMode.WALKING},function(a,o){o===google.maps.DirectionsStatus.OK?(e.setDirections(a),window.location.hash="route",route=a.routes[0]):window.alert("Directions request failed due to "+o)})}function addMarker(e,a,o){var i=new google.maps.Marker({position:e,map:a,animation:google.maps.Animation.DROP,title:o.name});findMarkers.push(i);var t=o.rating;"undefined"==typeof t&&(t="No Rating"),i.addListener("click",function(){infowindow.setContent("<b>"+o.name+"</b></br>Rating: "+t+'</br><input class="button button-blackboard markerbut" id="marker-add" type="button" value="Add Pub" >'),infowindow.open(a,i),$("#marker-add").on("click",function(){$(this).hide(),addPub(e,o.name)})})}function addPub(e,a){placeNames.push({pubName:a}),markers.push({location:e,stopover:!0}),$("#route-list").append("<li>"+a+"</li>"),$("#route").show()}function push(){var e=[];e=jQuery.extend([],markers);var a=$(".crawlname").val(),o=$("#location-search").val(),t=casaDataRef.push({crawlName:a,crawlLocation:o}),n=t.key();for(i=0;i<e.length;i++)casaDataRef.child(n).child("waypoints").child(i).set({lat:e[i].location.lat(),lng:e[i].location.lng(),stopover:e[i].stopover,PubName:placeNames[i].pubName});return n}var waypoints,placeNames=[],casaDataRef=new Firebase("https://casa-pubcrawl.firebaseio.com/routes");